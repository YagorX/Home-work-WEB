<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Личный кабинет</title>
    <link rel="stylesheet" href="styles/style2.css">
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f2f3f7;
            margin: 0;
            padding: 0;
        }
        .lk-wrapper {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        .lk-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .lk-title-block {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .lk-logo {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .lk-logo img {
            max-width: 40px;
        }
        .lk-title-block h1 {
            margin: 0;
            font-size: 26px;
        }
        .lk-title-block span {
            display: block;
            color: #777;
            font-size: 14px;
            margin-top: 4px;
        }
        .lk-actions {
            display: flex;
            gap: 12px;
        }
        .lk-btn {
            padding: 10px 20px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .lk-btn-back {
            background: #e9ecef;
            color: #333;
        }
        .lk-btn-logout {
            background: #e53935;
            color: #fff;
        }
        .lk-grid {
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: 20px;
        }
        .lk-card {
            background: #fff;
            border-radius: 18px;
            padding: 24px 28px;
            box-shadow:
                0 40px 80px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(15, 23, 42, 0.04);
        }
        .lk-card h2 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 20px;
        }
        .profile-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 15px;
        }
        .profile-label {
            color: #666;
        }
        .profile-value {
            font-weight: 500;
        }
        .profile-chip {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 13px;
            background: #e3f2fd;
            color: #1565c0;
        }
        /* Модалка "надо войти" */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.25);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .modal-overlay.show { display: flex; }
        .modal-window {
            background: #fff;
            border-radius: 24px;
            padding: 32px 36px;
            max-width: 600px;
            width: 90%;
            box-shadow:
                0 40px 90px rgba(15,23,42,0.35),
                0 0 0 1px rgba(15,23,42,0.04);
        }
        .modal-window h2 {
            margin-top: 0;
            margin-bottom: 16px;
            font-size: 22px;
        }
        .modal-window p {
            margin-top: 0;
            margin-bottom: 24px;
            color: #555;
        }
        .modal-btn {
            padding: 10px 22px;
            border-radius: 999px;
            border: none;
            background: #111827;
            color: #fff;
            cursor: pointer;
        }
        @media (max-width: 768px) {
            .lk-grid { grid-template-columns: 1fr; }
            .lk-header { flex-direction: column; align-items: flex-start; gap: 16px; }
        }
    </style>
</head>
<body>

<div class="lk-wrapper">
    <div class="lk-header">
        <div class="lk-title-block">
            <div class="lk-logo">
                <img src="images/renault_logo.png" alt="Renault">
            </div>
            <div>
                <h1>Личный кабинет</h1>
                <span>Ваши данные и выбранные автомобили</span>
            </div>
        </div>
        <div class="lk-actions">
            <button class="lk-btn lk-btn-back" id="backBtn">← На главную</button>
            <button class="lk-btn lk-btn-logout" id="logoutBtn">Выйти</button>
        </div>
    </div>

    <div class="lk-grid">
        <div class="lk-card">
            <h2>Профиль пользователя</h2>
            <div class="profile-row">
                <span class="profile-label">Логин:</span>
                <span class="profile-value" id="userLogin">—</span>
            </div>
            <div class="profile-row">
                <span class="profile-label">Email:</span>
                <span class="profile-value" id="userEmail">—</span>
            </div>
            <div class="profile-row">
                <span class="profile-label">ID пользователя:</span>
                <span class="profile-value" id="userId">—</span>
            </div>
            <div class="profile-row">
                <span class="profile-label">Статус:</span>
                <span class="profile-value">
                    <span class="profile-chip" id="userStatus">Обычный пользователь</span>
                </span>
            </div>
        </div>

        <div class="lk-card">
            <h2>Сохранённые автомобили</h2>
            <div id="savedCarsContainer">
                <p style="color:#777;">Сохранённые автомобили из корзины будут отображаться здесь.</p>
            </div>
        </div>
    </div>
</div>

<!-- модалка "надо войти" -->
<div class="modal-overlay" id="authModal">
    <div class="modal-window">
        <h2>Уведомление</h2>
        <p>Для доступа к личному кабинету необходимо войти в систему.</p>
        <button class="modal-btn" id="authModalClose">Закрыть</button>
    </div>
</div>

<script>
    // читаем то, что был сохранено при логине
    const token   = localStorage.getItem('auth_token');
    const username = localStorage.getItem('username');
    const email    = localStorage.getItem('email');
    const userId   = localStorage.getItem('user_id');
    const isAdmin  = localStorage.getItem('is_admin') === 'true';

    const authModal      = document.getElementById('authModal');
    const authModalClose = document.getElementById('authModalClose');

    function redirectToIndex() {
        // именно index.html, как ты просил
        window.location.href = 'index.html';
    }

    // если пользователь не залогинен — показываем модалку и потом уводим на главную
    if (!token || !username) {
        authModal.classList.add('show');
        authModalClose.addEventListener('click', redirectToIndex);
    } else {
        // заполняем профиль
        document.getElementById('userLogin').textContent = username;
        document.getElementById('userEmail').textContent = email || '—';
        document.getElementById('userId').textContent = userId || '—';
        document.getElementById('userStatus').textContent = isAdmin ? 'Администратор' : 'Обычный пользователь';

        // можно сюда же подгрузить корзину пользователя
        loadUserCart();
    }

    document.getElementById('backBtn').addEventListener('click', redirectToIndex);

    document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('auth_token');
        localStorage.removeItem('username');
        localStorage.removeItem('email');
        localStorage.removeItem('user_id');
        localStorage.removeItem('is_admin');
        redirectToIndex();
    });

    // та же корзина, что и на каталоге: просто читаем из localStorage по user_id
    function loadUserCart() {
        if (!userId) return;
        const key = `cart_${userId}`;
        const cartRaw = localStorage.getItem(key);
        const container = document.getElementById('savedCarsContainer');

        if (!cartRaw) {
            container.innerHTML = '<p style="color:#777;">У вас пока нет сохранённых автомобилей.</p>';
            return;
        }

        let cart;
        try {
            cart = JSON.parse(cartRaw);
        } catch (e) {
            container.innerHTML = '<p style="color:#e53935;">Ошибка чтения данных корзины.</p>';
            return;
        }

        if (!cart.length) {
            container.innerHTML = '<p style="color:#777;">У вас пока нет сохранённых автомобилей.</p>';
            return;
        }

        const list = document.createElement('div');
        list.style.display = 'flex';
        list.style.flexDirection = 'column';
        list.style.gap = '10px';

        cart.forEach(item => {
            const row = document.createElement('div');
            row.style.display = 'flex';
            row.style.justifyContent = 'space-between';
            row.style.alignItems = 'center';
            row.style.padding = '10px 12px';
            row.style.borderRadius = '12px';
            row.style.background = '#f8fafc';

            row.innerHTML = `
                <div>
                    <div style="font-weight:500;">${item.title}</div>
                    <div style="font-size:13px;color:#666;">Кол-во: ${item.quantity || 1}</div>
                </div>
                <div style="font-weight:600;color:#e53935;">
                    ${new Intl.NumberFormat('ru-RU', {style:'currency', currency:'RUB', minimumFractionDigits:0}).format(item.price)}
                </div>
            `;
            list.appendChild(row);
        });

        container.innerHTML = '';
        container.appendChild(list);
    }
</script>
</body>
</html>
